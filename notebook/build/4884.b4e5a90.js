"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4884],{24884:(t,e,n)=>{n.r(e),n.d(e,{default:()=>j});var a=n(10537),s=n(74547);const r=new s.Token("@jupyterlite/contents:IContents");var i;!function(t){t.JS="application/javascript",t.JSON="application/json",t.MANIFEST_JSON="application/manifest+json",t.PLAIN_TEXT="text/plain",t.PYTHON="application/x-python-code",t.SVG="image/svg+xml",t.XML="application/xml",t.KNOWN_TEXT_TYPES=new Set([t.JS,t.JSON,t.MANIFEST_JSON,t.PLAIN_TEXT,t.PYTHON,t.SVG,t.XML]),t.OCTET_STREAM="octet/stream"}(i||(i={}));var o=n(9879),c=n.n(o);const l="JupyterLite Storage";class u{constructor(t){this.reduceBytesToString=(t,e)=>t+String.fromCharCode(e),this._serverContents=new Map,this._storageName=l,this._storageDrivers=null,this._localforage=t.localforage,this._storageName=t.storageName||l,this._storageDrivers=t.storageDrivers||null,this._ready=new s.PromiseDelegate}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}async initStorage(){this._storage=this.createDefaultStorage(),this._counters=this.createDefaultCounters(),this._checkpoints=this.createDefaultCheckpoints()}get ready(){return this._ready.promise}get storage(){return this.ready.then((()=>this._storage))}get counters(){return this.ready.then((()=>this._counters))}get checkpoints(){return this.ready.then((()=>this._checkpoints))}get defaultStorageOptions(){const t=this._storageDrivers&&this._storageDrivers.length?this._storageDrivers:null;return{version:1,name:this._storageName,...t?{driver:t}:{}}}createDefaultStorage(){return this._localforage.createInstance({description:"Offline Storage for Notebooks and Files",storeName:"files",...this.defaultStorageOptions})}createDefaultCounters(){return this._localforage.createInstance({description:"Store the current file suffix counters",storeName:"counters",...this.defaultStorageOptions})}createDefaultCheckpoints(){return this._localforage.createInstance({description:"Offline Storage for Checkpoints",storeName:"checkpoints",...this.defaultStorageOptions})}async newUntitled(t){var e,n,s;const r=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",o=null!==(n=null==t?void 0:t.type)&&void 0!==n?n:"notebook",c=(new Date).toISOString();let l=a.PathExt.dirname(r);const u=a.PathExt.basename(r),g=a.PathExt.extname(r),h=await this.get(l);let d,w="";switch(r&&!g&&h?(l=`${r}/`,w=""):l&&u?(l=`${l}/`,w=u):(l="",w=r),o){case"directory":w=`Untitled Folder${await this._incrementCounter("directory")||""}`,d={name:w,path:`${l}${w}`,last_modified:c,created:c,format:"json",mimetype:"",content:null,size:void 0,writable:!0,type:"directory"};break;case"file":{const e=null!==(s=null==t?void 0:t.ext)&&void 0!==s?s:".txt",n=await this._incrementCounter("file");w=w||`untitled${n||""}${e}`,d={name:w,path:`${l}${w}`,last_modified:c,created:c,format:"text",mimetype:i.PLAIN_TEXT,content:"",size:0,writable:!0,type:"file"};break}default:{const t=await this._incrementCounter("notebook");w=w||`Untitled${t||""}.ipynb`,d={name:w,path:`${l}${w}`,last_modified:c,created:c,format:"json",mimetype:i.JSON,content:p.EMPTY_NB,size:JSON.stringify(p.EMPTY_NB).length,writable:!0,type:"notebook"};break}}const y=d.path;return await(await this.storage).setItem(y,d),d}async copy(t,e){let n=a.PathExt.basename(t);for(e=""===e?"":`${e.slice(1)}/`;await this.get(`${e}${n}`,{content:!0});){const t=a.PathExt.extname(n),e=n.replace(t,"");n=`${e} (copy)${t}`}const s=`${e}${n}`;let r=await this.get(t,{content:!0});if(!r)throw Error(`Could not find file with path ${t}`);return r={...r,name:n,path:s},await(await this.storage).setItem(s,r),r}async get(t,e){if(""===(t=decodeURIComponent(t.replace(/^\//,""))))return await this._getFolder(t);const n=await this.storage,s=await n.getItem(t),r=await this._getServerContents(t,e),o=s||r;if(!o)return null;if(!(null==e?void 0:e.content))return{...o,content:null,size:void 0};if("directory"===o.type){const e=new Map;await n.iterate(((n,a)=>{a===`${t}/${n.name}`&&e.set(n.name,n)}));const s=r?r.content:Array.from((await this._getServerDirectory(t)).values());for(const t of s)e.has(t.name)||e.set(t.name,t);const c=[...e.values()];return{name:a.PathExt.basename(t),path:t,last_modified:o.last_modified,created:o.created,format:"json",mimetype:i.JSON,content:c,size:void 0,writable:!0,type:"directory"}}return o}async rename(t,e){const n=decodeURIComponent(t),s=await this.get(n,{content:!0});if(!s)throw Error(`Could not find file with path ${n}`);const r=(new Date).toISOString(),i=a.PathExt.basename(e),o={...s,name:i,path:e,last_modified:r},c=await this.storage;if(await c.setItem(e,o),await c.removeItem(n),await(await this.checkpoints).removeItem(n),"directory"===s.type){let n;for(n of s.content)await this.rename(a.URLExt.join(t,n.name),a.URLExt.join(e,n.name))}return o}async save(t,e={}){var n;t=decodeURIComponent(t);let s=await this.get(t)||await this.newUntitled({path:t});if(!s)return null;const r=(new Date).toISOString();s={...s,...e,last_modified:r};const o=a.PathExt.extname(null!==(n=e.name)&&void 0!==n?n:""),l=c().getType(o)||i.OCTET_STREAM;return e.content&&"base64"===e.format&&(".ipynb"===o?s={...s,content:JSON.parse(this.unescapeContent(e.content)),format:"json",type:"notebook"}:i.KNOWN_TEXT_TYPES.has(l)&&(s={...s,content:this.unescapeContent(e.content),format:"text",type:"file"})),await(await this.storage).setItem(t,s),s}unescapeContent(t){return decodeURIComponent(escape(atob(t)))}async delete(t){const e=`${t=decodeURIComponent(t)}/`,n=(await(await this.storage).keys()).filter((n=>n===t||n.startsWith(e)));await Promise.all(n.map(this.forgetPath,this))}async forgetPath(t){await Promise.all([(await this.storage).removeItem(t),(await this.checkpoints).removeItem(t)])}async createCheckpoint(t){var e;const n=await this.checkpoints;t=decodeURIComponent(t);const a=await this.get(t,{content:!0});if(!a)throw Error(`Could not find file with path ${t}`);const s=(null!==(e=await n.getItem(t))&&void 0!==e?e:[]).filter(Boolean);return s.push(a),s.length>5&&s.splice(0,s.length-5),await n.setItem(t,s),{id:""+(s.length-1),last_modified:a.last_modified}}async listCheckpoints(t){return(await(await this.checkpoints).getItem(t)||[]).filter(Boolean).map(this.normalizeCheckpoint,this)}normalizeCheckpoint(t,e){return{id:e.toString(),last_modified:t.last_modified}}async restoreCheckpoint(t,e){t=decodeURIComponent(t);const n=(await(await this.checkpoints).getItem(t)||[])[parseInt(e)];await(await this.storage).setItem(t,n)}async deleteCheckpoint(t,e){t=decodeURIComponent(t);const n=await(await this.checkpoints).getItem(t)||[],a=parseInt(e);n.splice(a,1),await(await this.checkpoints).setItem(t,n)}async _getFolder(t){const e=new Map,n=await this.storage;await n.iterate(((t,n)=>{n.includes("/")||e.set(t.path,t)}));for(const n of(await this._getServerDirectory(t)).values())e.has(n.path)||e.set(n.path,n);return t&&0===e.size?null:{name:"",path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:i.JSON,content:Array.from(e.values()),size:void 0,writable:!0,type:"directory"}}async _getServerContents(t,e){const n=a.PathExt.basename(t);let s=(await this._getServerDirectory(a.URLExt.join(t,".."))).get(n);if(!s)return null;if(s=s||{name:n,path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"text",mimetype:i.PLAIN_TEXT,type:"file",writable:!0,content:null},null==e?void 0:e.content)if("directory"===s.type){const e=await this._getServerDirectory(t);s={...s,content:Array.from(e.values())}}else{const e=a.URLExt.join(a.PageConfig.getBaseUrl(),"files",t),n=await fetch(e);if(!n.ok)return null;const r=s.mimetype||n.headers.get("Content-Type");s="notebook"===s.type||-1!==(null==r?void 0:r.indexOf("json"))||t.match(/\.(ipynb|[^/]*json[^/]*)$/)?{...s,content:await n.json(),format:"json",mimetype:s.mimetype||i.JSON}:-1!==r.indexOf("text")||i.KNOWN_TEXT_TYPES.has(r)?{...s,content:await n.text(),format:"text",mimetype:r||i.PLAIN_TEXT}:{...s,content:btoa(new Uint8Array(await n.arrayBuffer()).reduce(this.reduceBytesToString,"")),format:"base64",mimetype:r||i.OCTET_STREAM}}return s}async _getServerDirectory(t){const e=this._serverContents.get(t)||new Map;if(!this._serverContents.has(t)){const n=a.URLExt.join(a.PageConfig.getBaseUrl(),"api/contents",t,"all.json");try{const t=await fetch(n),a=JSON.parse(await t.text());for(const t of a.content)e.set(t.name,t)}catch(t){console.warn(`don't worry, about ${t}... nothing's broken. If there had been a\n          file at ${n}, you might see some more files.`)}this._serverContents.set(t,e)}return e}async _incrementCounter(t){var e;const n=await this.counters,a=(null!==(e=await n.getItem(t))&&void 0!==e?e:-1)+1;return await n.setItem(t,a),a}}var p;!function(t){t.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:4,nbformat:4,cells:[]}}(p||(p={}));var g=n(28861),h=n(99900),d=n(78504),w=n(92649),y=n(41786),m=n(97048),f=n(20927),S=n.n(f);const v={id:"@jupyterlite/server-extension:localforage",autoStart:!0,provides:m.ILocalForage,activate:t=>({localforage:S()})},_={id:"@jupyterlite/server-extension:localforage-memory-storage",autoStart:!0,requires:[m.ILocalForage],activate:async(t,e)=>{JSON.parse(a.PageConfig.getOption("enableMemoryStorage")||"false")&&(console.warn("Memory storage fallback enabled: contents and settings may not be saved"),await(0,m.ensureMemoryStorage)(e.localforage))}},O={id:"@jupyterlite/server-extension:contents",requires:[m.ILocalForage],autoStart:!0,provides:r,activate:(t,e)=>{const n=a.PageConfig.getOption("contentsStorageName"),s=JSON.parse(a.PageConfig.getOption("contentsStorageDrivers")||"null"),{localforage:r}=e,i=new u({storageName:n,storageDrivers:s,localforage:r});return t.started.then((()=>i.initialize().catch(console.warn))),i}},N={id:"@jupyterlite/server-extension:contents-routes",autoStart:!0,requires:[r],activate:(t,e)=>{t.router.get("/api/contents/(.+)/checkpoints",(async(t,n)=>{const a=await e.listCheckpoints(n);return new Response(JSON.stringify(a))})),t.router.post("/api/contents/(.+)/checkpoints/(.*)",(async(t,n,a)=>{const s=await e.restoreCheckpoint(n,a);return new Response(JSON.stringify(s),{status:204})})),t.router.post("/api/contents/(.+)/checkpoints",(async(t,n)=>{const a=await e.createCheckpoint(n);return new Response(JSON.stringify(a),{status:201})})),t.router.delete("/api/contents/(.+)/checkpoints/(.*)",(async(t,n,a)=>{const s=await e.deleteCheckpoint(n,a);return new Response(JSON.stringify(s),{status:204})})),t.router.get("/api/contents(.*)",(async(t,n)=>{var a;const s={content:"1"===(null===(a=t.query)||void 0===a?void 0:a.content)},r=await e.get(n,s);return r?new Response(JSON.stringify(r)):new Response(null,{status:404})})),t.router.post("/api/contents(.*)",(async(t,n)=>{const a=t.body,s=null==a?void 0:a.copy_from;let r;return r=s?await e.copy(s,n):await e.newUntitled(a),r?new Response(JSON.stringify(r),{status:201}):new Response(null,{status:400})})),t.router.patch("/api/contents(.*)",(async(t,n)=>{var a,s;const r=null!==(s=null===(a=t.body)||void 0===a?void 0:a.path)&&void 0!==s?s:"";n="/"===n[0]?n.slice(1):n;const i=await e.rename(n,r);return new Response(JSON.stringify(i))})),t.router.put("/api/contents/(.+)",(async(t,n)=>{const a=t.body,s=await e.save(n,a);return new Response(JSON.stringify(s))})),t.router.delete("/api/contents/(.+)",(async(t,n)=>(await e.delete(n),new Response(null,{status:204}))))}},I={id:"@jupyterlite/server-extension:kernels",autoStart:!0,provides:g.IKernels,requires:[g.IKernelSpecs],activate:(t,e)=>new g.Kernels({kernelspecs:e})},C={id:"@jupyterlite/server-extension:kernels-routes",autoStart:!0,requires:[g.IKernels],activate:(t,e)=>{t.router.post("/api/kernels/(.*)/restart",(async(t,n)=>{const a=await e.restart(n);return new Response(JSON.stringify(a))})),t.router.delete("/api/kernels/(.*)",(async(t,n)=>{const a=await e.shutdown(n);return new Response(JSON.stringify(a),{status:204})}))}},k={id:"@jupyterlite/server-extension:kernelspec",autoStart:!0,provides:g.IKernelSpecs,activate:t=>new g.KernelSpecs({})},x={id:"@jupyterlite/server-extension:kernelspec-routes",autoStart:!0,requires:[g.IKernelSpecs],activate:(t,e)=>{t.router.get("/api/kernelspecs",(async t=>{const n=e.specs;return new Response(JSON.stringify(n))}))}},T={id:"@jupyterlite/server-extension:licenses",autoStart:!0,provides:h.ILicenses,activate:t=>new h.Licenses},b={id:"@jupyterlite/server-extension:licenses-routes",autoStart:!0,requires:[h.ILicenses],activate(t,e){t.router.get("/api/licenses",(async t=>{const n=await e.get();return new Response(JSON.stringify(n))}))}},R={id:"@jupyterlite/server-extension:nbconvert-routes",autoStart:!0,activate:t=>{t.router.get("/api/nbconvert",(async t=>new Response(JSON.stringify({}))))}},E={id:"@jupyterlite/server-extension:sessions",autoStart:!0,provides:d.ISessions,requires:[g.IKernels],activate:(t,e)=>new d.Sessions({kernels:e})},J={id:"@jupyterlite/server-extension:sessions-routes",autoStart:!0,requires:[d.ISessions],activate:(t,e)=>{t.router.get("/api/sessions/(.+)",(async(t,n)=>{const a=await e.get(n);return new Response(JSON.stringify(a),{status:200})})),t.router.get("/api/sessions",(async t=>{const n=await e.list();return new Response(JSON.stringify(n),{status:200})})),t.router.patch("/api/sessions(.*)",(async(t,n)=>{const a=t.body,s=await e.patch(a);return new Response(JSON.stringify(s),{status:200})})),t.router.delete("/api/sessions/(.+)",(async(t,n)=>(await e.shutdown(n),new Response(null,{status:204})))),t.router.post("/api/sessions",(async t=>{const n=t.body,a=await e.startNew(n);return new Response(JSON.stringify(a),{status:201})}))}},P={id:"@jupyterlite/server-extension:settings",autoStart:!0,requires:[m.ILocalForage],provides:w.ISettings,activate:(t,e)=>{const n=a.PageConfig.getOption("settingsStorageName"),s=JSON.parse(a.PageConfig.getOption("settingsStorageDrivers")||"null"),{localforage:r}=e,i=new w.Settings({storageName:n,storageDrivers:s,localforage:r});return t.started.then((()=>i.initialize().catch(console.warn))),i}},j=[O,N,I,C,k,x,T,b,_,v,R,E,J,P,{id:"@jupyterlite/server-extension:settings-routes",autoStart:!0,requires:[w.ISettings],activate:(t,e)=>{const n="/api/settings/((?:@([^/]+?)[/])?([^/]+?):([^:]+))$";t.router.get(n,(async(t,n)=>{const a=await e.get(n);return new Response(JSON.stringify(a))})),t.router.put(n,(async(t,n)=>{const a=t.body,{raw:s}=a;return await e.save(n,s),new Response(null,{status:204})})),t.router.get("/api/settings",(async t=>{const n=await e.getAll();return new Response(JSON.stringify(n))}))}},{id:"@jupyterlite/server-extension:translation",autoStart:!0,provides:y.ITranslation,activate:t=>{const e=new y.Translation;return t.router.get("/api/translations/?(.*)",(async(t,n)=>{const a=await e.get(n||"all");return new Response(JSON.stringify(a))})),e}},{id:"@jupyterlite/server-extension:translation-routes",autoStart:!0,requires:[y.ITranslation],activate:(t,e)=>{t.router.get("/api/translations/?(.*)",(async(t,n)=>{const a=await e.get(n||"all");return new Response(JSON.stringify(a))}))}}]}}]);
//# sourceMappingURL=4884.b4e5a90.js.map